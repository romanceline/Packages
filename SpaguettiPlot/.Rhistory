document()
library(devtools)
document()
use_package('dplyr')
use_package('httr')
use_package('jsonlite')
document()
getwd()
setwd('..')
getwd()
install('GetEpiData')
install('GetEpiData')
getwd()
library(devtools)
install('GetEpiData')
GetEpiData()
library(GetEpiData)
GetEpiData()
library(dplyr)
GetEpiData()
install('GetEpiData')
install.packages('jsonlite')
library(jsonlite)
install('GetEpiData')
GetEpiData()
library(httr)
GetEpiData()
dataset<-GetEpiData()
color<-'#000000'
Comparative_SpaguettiPlot<-function (Country,Variable,AllOrSelectiveComparison,col){
Dataset<-GetEpiData()
Variable<-sym(Variable)
if(AllOrSelectiveComparison=="All"){
Dataset<-MainDataset
CountriesToCompare<-data.frame()
}
if(AllOrSelectiveComparison=="Selective"){
CountriesToCompare <-ComparisonMatrix %>% filter(CountryOfInterest==Country) %>%
pivot_longer(cols=c(ToCompareWith_1:ToCompareWith_12),values_to="ToCompareWith") %>%
select(-name) %>% mutate(ToCompareWith=str_to_title(ToCompareWith)) %>% drop_na()
Dataset<-MainDataset %>% filter(ADM0NAME %in% CountriesToCompare$ToCompareWith)
}
if (grepl("Cases", Variable))
{if (Variable=="NewCases") {labelY<-"Daily number of cases"}
else if (Variable=="TotalCases") {labelY<-"Total number of cases"}
else if (Variable=="DailyRateCases") {labelY<-"Daily rate of cases (per 100.000)"}
else if (Variable=="CumulativeRateCases") {labelY<-"Cumulative rate of cases (per 100.000)"}}
else if (grepl("Deaths", Variable))
{if (Variable=="NewDeaths") {labelY<-"Daily number of deaths"}
else if (Variable=="TotalDeaths") {labelY<-"Total number of deaths"}
else if (Variable=="DailyRateDeaths") {labelY<-"Daily rate of deaths (per one million)"}
else if (Variable=="CumulativeRateDeaths") {labelY<-"Cumulative rate of deaths (per one million)"}}
CountryDataset<-MainDataset %>% filter (ADM0NAME==Country)
plot<-ggplot()+
geom_line(data=Dataset,aes(x=DateReport1,y=!!Variable,group=ADM0NAME),color="grey")+
geom_line(data=CountryDataset,
aes(x=DateReport1,y=!!Variable),
color=col,size=0.8)+
labs(x="Date",y=labelY)
return(list(CountriesToCompare=CountriesToCompare,plot=plot,color=col,variable=Variable))
}
Comparative_SpaguettiPlot<-function (Country,Variable,AllOrSelectiveComparison,col){
Dataset<-GetEpiData()
Variable<-sym(Variable)
if(AllOrSelectiveComparison=="All"){
CountriesToCompare<-data.frame()
}
if(AllOrSelectiveComparison=="Selective"){
CountriesToCompare <-ComparisonMatrix %>% filter(CountryOfInterest==Country) %>%
pivot_longer(cols=c(ToCompareWith_1:ToCompareWith_12),values_to="ToCompareWith") %>%
select(-name) %>% mutate(ToCompareWith=str_to_title(ToCompareWith)) %>% drop_na()
Dataset<-MainDataset %>% filter(ADM0NAME %in% CountriesToCompare$ToCompareWith)
}
if (grepl("Cases", Variable))
{if (Variable=="NewCases") {labelY<-"Daily number of cases"}
else if (Variable=="TotalCases") {labelY<-"Total number of cases"}
else if (Variable=="DailyRateCases") {labelY<-"Daily rate of cases (per 100.000)"}
else if (Variable=="CumulativeRateCases") {labelY<-"Cumulative rate of cases (per 100.000)"}}
else if (grepl("Deaths", Variable))
{if (Variable=="NewDeaths") {labelY<-"Daily number of deaths"}
else if (Variable=="TotalDeaths") {labelY<-"Total number of deaths"}
else if (Variable=="DailyRateDeaths") {labelY<-"Daily rate of deaths (per one million)"}
else if (Variable=="CumulativeRateDeaths") {labelY<-"Cumulative rate of deaths (per one million)"}}
CountryDataset<-MainDataset %>% filter (ADM0NAME==Country)
plot<-ggplot()+
geom_line(data=Dataset,aes(x=DateReport1,y=!!Variable,group=ADM0NAME),color="grey")+
geom_line(data=CountryDataset,
aes(x=DateReport1,y=!!Variable),
color=col,size=0.8)+
labs(x="Date",y=labelY)
return(list(CountriesToCompare=CountriesToCompare,plot=plot,color=col,variable=Variable))
}
col<-color
col
Dataset<-GetEpiData() %>% mutate(ADM0NAME=str_to_title(ADM0NAME))
Dataset<-GetEpiData()
View(Dataset)
Dataset<-GetEpiData() %>% select(ADM0NAME=str_to_title(ADM0NAME))
library(stringr)
Dataset<-GetEpiData() %>% mutate(ADM0NAME=str_to_title(ADM0NAME))
Variable<-'NewDeaths'
AllOrSelectiveComparison<-'All'
if(AllOrSelectiveComparison=="All"){
CountriesToCompare<-data.frame()
}
Dataset<-GetEpiData() %>% mutate(ADM0NAME=str_to_title(ADM0NAME))
if (grepl("Cases", Variable))
{if (Variable=="NewCases") {labelY<-"Daily number of cases"}
else if (Variable=="TotalCases") {labelY<-"Total number of cases"}
else if (Variable=="DailyRateCases") {labelY<-"Daily rate of cases (per 100.000)"}
else if (Variable=="CumulativeRateCases") {labelY<-"Cumulative rate of cases (per 100.000)"}}
Variable
labelY
else if (grepl("Deaths", Variable))
{if (Variable=="NewDeaths") {labelY<-"Daily number of deaths"}
else if (Variable=="TotalDeaths") {labelY<-"Total number of deaths"}
else if (Variable=="DailyRateDeaths") {labelY<-"Daily rate of deaths (per one million)"}
else if (Variable=="CumulativeRateDeaths") {labelY<-"Cumulative rate of deaths (per one million)"}}
labelY
CountryDataset<-Dataset %>% filter (ADM0NAME==Country)
Country
Country<-'Belgium'
CountryDataset<-Dataset %>% filter (ADM0NAME==Country)
plot<-ggplot()+
geom_line(data=Dataset,aes(x=DateReport1,y=!!Variable,group=ADM0NAME),color="grey")+
geom_line(data=CountryDataset,
aes(x=DateReport1,y=!!Variable),
color=col,size=0.8)+
labs(x="Date",y=labelY)
library(ggplot2)
plot<-ggplot()+
geom_line(data=Dataset,aes(x=DateReport1,y=!!Variable,group=ADM0NAME),color="grey")+
geom_line(data=CountryDataset,
aes(x=DateReport1,y=!!Variable),
color=col,size=0.8)+
labs(x="Date",y=labelY)
plot
Dataset<-GetEpiData() %>% mutate(ADM0NAME=str_to_title(ADM0NAME))
View(Dataset)
plot<-ggplot()+
geom_line(data=Dataset,aes(x=DateReport,y=!!Variable,group=ADM0NAME),color="grey")+
geom_line(data=CountryDataset,
aes(x=DateReport1,y=!!Variable),
color=col,size=0.8)+
labs(x="Date",y=labelY)
plot
plot<-ggplot()+
geom_line(data=Dataset,aes(x=DateReport,y=!!Variable,group=ADM0NAME),color="grey")+
geom_line(data=CountryDataset,
aes(x=DateReport,y=!!Variable),
color=col,size=0.8)+
labs(x="Date",y=labelY)
plot
View(CountryDataset)
View(Dataset)
plot<-ggplot()+
geom_line(data=Dataset,aes(x=DateReport,y=!!Variable,group=ADM0NAME),color="grey")
plot
Variable<-sym(Variable)
Comparative_SpaguettiPlot<-function (Country,Variable,AllOrSelectiveComparison,col){
Dataset<-GetEpiData() %>% mutate(ADM0NAME=str_to_title(ADM0NAME))
Variable<-sym(Variable)
if(AllOrSelectiveComparison=="All"){
CountriesToCompare<-data.frame()
}
if(AllOrSelectiveComparison=="Selective"){
CountriesToCompare <-ComparisonMatrix %>% filter(CountryOfInterest==Country) %>%
pivot_longer(cols=c(ToCompareWith_1:ToCompareWith_12),values_to="ToCompareWith") %>%
select(-name) %>% mutate(ToCompareWith=str_to_title(ToCompareWith)) %>% drop_na()
Dataset<-MainDataset %>% filter(ADM0NAME %in% CountriesToCompare$ToCompareWith)
}
if (grepl("Cases", Variable))
{if (Variable=="NewCases") {labelY<-"Daily number of cases"}
else if (Variable=="TotalCases") {labelY<-"Total number of cases"}
else if (Variable=="DailyRateCases") {labelY<-"Daily rate of cases (per 100.000)"}
else if (Variable=="CumulativeRateCases") {labelY<-"Cumulative rate of cases (per 100.000)"}}
else if (grepl("Deaths", Variable))
{if (Variable=="NewDeaths") {labelY<-"Daily number of deaths"}
else if (Variable=="TotalDeaths") {labelY<-"Total number of deaths"}
else if (Variable=="DailyRateDeaths") {labelY<-"Daily rate of deaths (per one million)"}
else if (Variable=="CumulativeRateDeaths") {labelY<-"Cumulative rate of deaths (per one million)"}}
CountryDataset<-Dataset %>% filter (ADM0NAME==Country)
plot<-ggplot()+
geom_line(data=Dataset,aes(x=DateReport,y=!!Variable,group=ADM0NAME),color="grey")+
geom_line(data=CountryDataset,
aes(x=DateReport,y=!!Variable),
color=col,size=0.8)+
labs(x="Date",y=labelY)
return(list(CountriesToCompare=CountriesToCompare,plot=plot,color=col,variable=Variable))
}
Comparative_SpaguettiPlot('Belgium','NewDeaths','All',col)
Dataset<-GetEpiData() %>% mutate(ADM0NAME=str_to_title(ADM0NAME))
View(Dataset)
Comparative_SpaguettiPlot<-function (Country,Variable,AllOrSelectiveComparison,col){
Dataset<-GetEpiData() %>% mutate(ADM0NAME=str_to_title(ADM0NAME))
Variable<-sym(Variable)
if(AllOrSelectiveComparison=="All"){
CountriesToCompare<-data.frame()
}
if(AllOrSelectiveComparison=="Selective"){
CountriesToCompare <-ComparisonMatrix %>% filter(CountryOfInterest==Country) %>%
pivot_longer(cols=c(ToCompareWith_1:ToCompareWith_12),values_to="ToCompareWith") %>%
select(-name) %>% mutate(ToCompareWith=str_to_title(ToCompareWith)) %>% drop_na()
Dataset<-MainDataset %>% filter(ADM0NAME %in% CountriesToCompare$ToCompareWith)
}
if (grepl("Cases", Variable))
{if (Variable=="NewCases") {labelY<-"Daily number of cases"}
else if (Variable=="TotalCases") {labelY<-"Total number of cases"}
else if (Variable=="DailyRateCases") {labelY<-"Daily rate of cases (per 100.000)"}
else if (Variable=="CumulativeRateCases") {labelY<-"Cumulative rate of cases (per 100.000)"}}
else if (grepl("Deaths", Variable))
{if (Variable=="NewDeaths") {labelY<-"Daily number of deaths"}
else if (Variable=="TotalDeaths") {labelY<-"Total number of deaths"}
else if (Variable=="DailyRateDeaths") {labelY<-"Daily rate of deaths (per one million)"}
else if (Variable=="CumulativeRateDeaths") {labelY<-"Cumulative rate of deaths (per one million)"}}
CountryDataset<-Dataset %>% filter (ADM0NAME==Country)
plot<-ggplot()+
geom_line(data=Dataset,aes(x=DateReport,y=!!Variable,group=ADM0NAME),color="grey")+
geom_line(data=CountryDataset,
aes(x=DateReport,y=!!Variable),
color=col,size=0.8)+
labs(x="Date",y=labelY)+
theme_minimal()
return(list(CountriesToCompare=CountriesToCompare,plot=plot,color=col,variable=Variable))
}
Comparative_SpaguettiPlot('Belgium','NewDeaths','All',col)
getwd()
create('SpaguettiPlot')
getwd('C:/Users/romanc/Documents/GitHub/Packages/SpaguettiPlot')
setwd('C:/Users/romanc/Documents/GitHub/Packages/SpaguettiPlot')
use_package('stringr')
use_package('ggplot2')
use_package('dplyr')
use_data_raw()
Population<-read.csv('ref_Country.csv')
Population<-read.csv('/ref_Country.csv')
setwd('C:/Users/romanc/Documents/GitHub/Packages/WHOCountryNames/data-raw')
Population<-read.csv('ref_Country.csv')
usethis::use_data(Population, overwrite = TRUE)
View(Population)
Population<-Population %>% mutate(ADM0NAME=str_to_title(ADM0NAME))
Dataset<-GetEpiData() %>% mutate(ADM0NAME=str_to_title(ADM0NAME)) %>%
left_join(Population, by='ADM0NAME')
View(Dataset)
Population<-Population %>% mutate(ADM0NAME=str_to_title(ADM0NAME)) %>% select(ADM0NAME,UNPOP2019)
Dataset<-GetEpiData() %>% mutate(ADM0NAME=str_to_title(ADM0NAME)) %>%
left_join(Population, by='ADM0NAME')
View(Dataset)
Dataset<-GetEpiData() %>% mutate(ADM0NAME=str_to_title(ADM0NAME)) %>%
left_join(Population, by='ADM0NAME') %>%
mutate(DailyRateCases=NewCases/UNPOP2019*100000)
Dataset<-GetEpiData() %>% mutate(ADM0NAME=str_to_title(ADM0NAME)) %>%
left_join(Population, by='ADM0NAME') %>%
mutate(DailyRateCases=NewCases/UNPOP2019*100000,
DailyRateDeaths=NewDeaths/UNPOP2019*100000,
CumulativeRateCases=TotalCases/UNPOP2019*1000000,
CumulativeRateDeaths=TotalDeaths/UNPOP2019*1000000)
Comparative_SpaguettiPlot<-function (Country,Variable,AllOrSelection,col){
Population<-Population %>% mutate(ADM0NAME=str_to_title(ADM0NAME)) %>% select(ADM0NAME,UNPOP2019)
Dataset<-GetEpiData() %>% mutate(ADM0NAME=str_to_title(ADM0NAME)) %>%
left_join(Population, by='ADM0NAME') %>%
mutate(DailyRateCases=NewCases/UNPOP2019*100000,
DailyRateDeaths=NewDeaths/UNPOP2019*100000,
CumulativeRateCases=TotalCases/UNPOP2019*1000000,
CumulativeRateDeaths=TotalDeaths/UNPOP2019*1000000)
Variable<-sym(Variable)
if(AllOrSelectiveComparison=="All"){
CountriesToCompare<-data.frame()
}
if(AllOrSelectiveComparison=="Selective"){
CountriesToCompare <-ComparisonMatrix %>% filter(CountryOfInterest==Country) %>%
pivot_longer(cols=c(ToCompareWith_1:ToCompareWith_12),values_to="ToCompareWith") %>%
select(-name) %>% mutate(ToCompareWith=str_to_title(ToCompareWith)) %>% drop_na()
Dataset<-MainDataset %>% filter(ADM0NAME %in% CountriesToCompare$ToCompareWith)
}
if (grepl("Cases", Variable))
{if (Variable=="NewCases") {labelY<-"Daily number of cases"}
else if (Variable=="TotalCases") {labelY<-"Total number of cases"}
else if (Variable=="DailyRateCases") {labelY<-"Daily rate of cases (per 100.000)"}
else if (Variable=="CumulativeRateCases") {labelY<-"Cumulative rate of cases (per 100.000)"}}
else if (grepl("Deaths", Variable))
{if (Variable=="NewDeaths") {labelY<-"Daily number of deaths"}
else if (Variable=="TotalDeaths") {labelY<-"Total number of deaths"}
else if (Variable=="DailyRateDeaths") {labelY<-"Daily rate of deaths (per one million)"}
else if (Variable=="CumulativeRateDeaths") {labelY<-"Cumulative rate of deaths (per one million)"}}
CountryDataset<-Dataset %>% filter (ADM0NAME==Country)
plot<-ggplot()+
geom_line(data=Dataset,aes(x=DateReport,y=!!Variable,group=ADM0NAME),color="grey")+
geom_line(data=CountryDataset,
aes(x=DateReport,y=!!Variable),
color=col,size=0.8)+
labs(x="Date",y=labelY)+
theme_minimal()
return(list(CountriesToCompare=CountriesToCompare,plot=plot,color=col,variable=Variable))
}
Comparative_SpaguettiPlot('France','DailyRateCases','All','Cases')
Comparative_SpaguettiPlot('France','DailyRateCases','All',col)
ListCountriesToCompare<-c('France','Germany','Italy','United Kingdom')
Dataset <- Dataset %>% filter (ADM0NAME %in% ListCountriesToCompare)
View(Dataset)
Comparative_SpaguettiPlot<-function (Country,Variable,AllOrSelection,ListCountriesToCompare,col){
Population<-Population %>% mutate(ADM0NAME=str_to_title(ADM0NAME)) %>% select(ADM0NAME,UNPOP2019)
Dataset<-GetEpiData() %>% mutate(ADM0NAME=str_to_title(ADM0NAME)) %>%
left_join(Population, by='ADM0NAME') %>%
mutate(DailyRateCases=NewCases/UNPOP2019*100000,
DailyRateDeaths=NewDeaths/UNPOP2019*100000,
CumulativeRateCases=TotalCases/UNPOP2019*1000000,
CumulativeRateDeaths=TotalDeaths/UNPOP2019*1000000)
Variable<-sym(Variable)
if(AllOrSelectiveComparison=="All"){
CountriesToCompare<-data.frame()
}
if(AllOrSelectiveComparison=="Selective"){
Dataset <- Dataset %>% filter (ADM0NAME %in% ListCountriesToCompare)
}
if (grepl("Cases", Variable))
{if (Variable=="NewCases") {labelY<-"Daily number of cases"}
else if (Variable=="TotalCases") {labelY<-"Total number of cases"}
else if (Variable=="DailyRateCases") {labelY<-"Daily rate of cases (per 100.000)"}
else if (Variable=="CumulativeRateCases") {labelY<-"Cumulative rate of cases (per 100.000)"}}
else if (grepl("Deaths", Variable))
{if (Variable=="NewDeaths") {labelY<-"Daily number of deaths"}
else if (Variable=="TotalDeaths") {labelY<-"Total number of deaths"}
else if (Variable=="DailyRateDeaths") {labelY<-"Daily rate of deaths (per one million)"}
else if (Variable=="CumulativeRateDeaths") {labelY<-"Cumulative rate of deaths (per one million)"}}
CountryDataset<-Dataset %>% filter (ADM0NAME==Country)
plot<-ggplot()+
geom_line(data=Dataset,aes(x=DateReport,y=!!Variable,group=ADM0NAME),color="grey")+
geom_line(data=CountryDataset,
aes(x=DateReport,y=!!Variable),
color=col,size=0.8)+
labs(x="Date",y=labelY)+
theme_minimal()
return(list(CountriesToCompare=CountriesToCompare,plot=plot,color=col,variable=Variable))
}
Comparative_SpaguettiPlot('France','DailyRateCases','Selective',ListCountriesToCompare,col)
#' Comparative_SpaguettiPlot function
#' This function will highlight one variable (NewDeats, NewCases, CasesIncidence, DeathsIncidence) for one country against other countries
#' @param Country - Country to highlight
#' @param Variable - Variable can be NewCases,NewDeaths,TotalCases,TotalDeaths, DailyRateCases, DailyRateDeaths, CumulativeRateCases,CumulativeRateDeaths
#' @param AllOrSelection - Use 'All' at the moment (more developments later)
#' @param color - Color to use to highlight the country Ex: '#000000'
#' @export
Comparative_SpaguettiPlot<-function (Country,Variable,AllOrSelection,ListCountriesToCompare,col){
Population<-Population %>% mutate(ADM0NAME=str_to_title(ADM0NAME)) %>% select(ADM0NAME,UNPOP2019)
Dataset<-GetEpiData() %>% mutate(ADM0NAME=str_to_title(ADM0NAME)) %>%
left_join(Population, by='ADM0NAME') %>%
mutate(DailyRateCases=NewCases/UNPOP2019*100000,
DailyRateDeaths=NewDeaths/UNPOP2019*100000,
CumulativeRateCases=TotalCases/UNPOP2019*1000000,
CumulativeRateDeaths=TotalDeaths/UNPOP2019*1000000)
Variable<-sym(Variable)
if(AllOrSelectiveComparison=="All"){
ComparativeDataset<-Dataset
}
if(AllOrSelectiveComparison=="Selective"){
ComparativeDataset <- Dataset %>% filter (ADM0NAME %in% ListCountriesToCompare)
}
if (grepl("Cases", Variable))
{if (Variable=="NewCases") {labelY<-"Daily number of cases"}
else if (Variable=="TotalCases") {labelY<-"Total number of cases"}
else if (Variable=="DailyRateCases") {labelY<-"Daily rate of cases (per 100.000)"}
else if (Variable=="CumulativeRateCases") {labelY<-"Cumulative rate of cases (per 100.000)"}}
else if (grepl("Deaths", Variable))
{if (Variable=="NewDeaths") {labelY<-"Daily number of deaths"}
else if (Variable=="TotalDeaths") {labelY<-"Total number of deaths"}
else if (Variable=="DailyRateDeaths") {labelY<-"Daily rate of deaths (per one million)"}
else if (Variable=="CumulativeRateDeaths") {labelY<-"Cumulative rate of deaths (per one million)"}}
CountryDataset<-Dataset %>% filter (ADM0NAME==Country)
plot<-ggplot()+
geom_line(data=ComparativeDataset,aes(x=DateReport,y=!!Variable,group=ADM0NAME),color="grey")+
geom_line(data=CountryDataset,
aes(x=DateReport,y=!!Variable),
color=col,size=0.8)+
labs(x="Date",y=labelY)+
theme_minimal()
return(list(CountriesToCompare=CountriesToCompare,plot=plot,color=col,variable=Variable))
}
Comparative_SpaguettiPlot('Belgium','DailyRateCases','Selective',ListCountriesToCompare,col)
#' Comparative_SpaguettiPlot function
#' This function will highlight one variable (NewDeats, NewCases, CasesIncidence, DeathsIncidence) for one country against other countries
#' @param Country - Country to highlight
#' @param Variable - Variable can be NewCases,NewDeaths,TotalCases,TotalDeaths, DailyRateCases, DailyRateDeaths, CumulativeRateCases,CumulativeRateDeaths
#' @param AllOrSelection - Use 'All' at the moment (more developments later)
#' @param color - Color to use to highlight the country Ex: '#000000'
#' @export
Comparative_SpaguettiPlot<-function (Country,Variable,AllOrSelection,ListCountriesToCompare,col){
Population<-Population %>% mutate(ADM0NAME=str_to_title(ADM0NAME)) %>% select(ADM0NAME,UNPOP2019)
Dataset<-GetEpiData() %>% mutate(ADM0NAME=str_to_title(ADM0NAME)) %>%
left_join(Population, by='ADM0NAME') %>%
mutate(DailyRateCases=NewCases/UNPOP2019*100000,
DailyRateDeaths=NewDeaths/UNPOP2019*100000,
CumulativeRateCases=TotalCases/UNPOP2019*1000000,
CumulativeRateDeaths=TotalDeaths/UNPOP2019*1000000)
Variable<-sym(Variable)
if(AllOrSelectiveComparison=="All"){
ComparativeDataset<-Dataset
}
if(AllOrSelectiveComparison=="Selective"){
ComparativeDataset <- Dataset %>% filter (ADM0NAME %in% ListCountriesToCompare)
}
if (grepl("Cases", Variable))
{if (Variable=="NewCases") {labelY<-"Daily number of cases"}
else if (Variable=="TotalCases") {labelY<-"Total number of cases"}
else if (Variable=="DailyRateCases") {labelY<-"Daily rate of cases (per 100.000)"}
else if (Variable=="CumulativeRateCases") {labelY<-"Cumulative rate of cases (per 100.000)"}}
else if (grepl("Deaths", Variable))
{if (Variable=="NewDeaths") {labelY<-"Daily number of deaths"}
else if (Variable=="TotalDeaths") {labelY<-"Total number of deaths"}
else if (Variable=="DailyRateDeaths") {labelY<-"Daily rate of deaths (per one million)"}
else if (Variable=="CumulativeRateDeaths") {labelY<-"Cumulative rate of deaths (per one million)"}}
CountryDataset<-Dataset %>% filter (ADM0NAME==Country)
plot<-ggplot()+
geom_line(data=ComparativeDataset,aes(x=DateReport,y=!!Variable,group=ADM0NAME),color="grey")+
geom_line(data=CountryDataset,
aes(x=DateReport,y=!!Variable),
color=col,size=0.8)+
labs(x="Date",y=labelY)+
theme_minimal()
return(list(plot=plot,color=col,variable=Variable))
}
Comparative_SpaguettiPlot('Belgium','DailyRateCases','Selective',ListCountriesToCompare,col)$plot
ListCountriesToCompare<-c('France')
Comparative_SpaguettiPlot('Belgium','DailyRateCases','Selective',ListCountriesToCompare,col)$plot
AllOrSelection<-'Selective'
Variable<-'NewCases'
Dataset<-GetEpiData() %>% mutate(ADM0NAME=str_to_title(ADM0NAME)) %>%
left_join(Population, by='ADM0NAME') %>%
mutate(DailyRateCases=NewCases/UNPOP2019*100000,
DailyRateDeaths=NewDeaths/UNPOP2019*100000,
CumulativeRateCases=TotalCases/UNPOP2019*1000000,
CumulativeRateDeaths=TotalDeaths/UNPOP2019*1000000)
Variable<-sym(Variable)
if(AllOrSelectiveComparison=="All"){
ComparativeDataset<-Dataset
}
View(ComparativeDataset)
if(AllOrSelectiveComparison=="Selective"){
ComparativeDataset <- Dataset %>% filter (ADM0NAME %in% ListCountriesToCompare)
}
AllOrSelectiveComparison
AllOrSelection<-'Selection'
Dataset<-GetEpiData() %>% mutate(ADM0NAME=str_to_title(ADM0NAME)) %>%
left_join(Population, by='ADM0NAME') %>%
mutate(DailyRateCases=NewCases/UNPOP2019*100000,
DailyRateDeaths=NewDeaths/UNPOP2019*100000,
CumulativeRateCases=TotalCases/UNPOP2019*1000000,
CumulativeRateDeaths=TotalDeaths/UNPOP2019*1000000)
Variable<-sym(Variable)
if(AllOrSelection=="All"){
ComparativeDataset<-Dataset
}
if(AllOrSelectionveComparison=="Selection"){
ComparativeDataset <- Dataset %>% filter (ADM0NAME %in% ListCountriesToCompare)
}
Dataset<-GetEpiData() %>% mutate(ADM0NAME=str_to_title(ADM0NAME)) %>%
left_join(Population, by='ADM0NAME') %>%
mutate(DailyRateCases=NewCases/UNPOP2019*100000,
DailyRateDeaths=NewDeaths/UNPOP2019*100000,
CumulativeRateCases=TotalCases/UNPOP2019*1000000,
CumulativeRateDeaths=TotalDeaths/UNPOP2019*1000000)
Variable<-sym(Variable)
if(AllOrSelection=="All"){
ComparativeDataset<-Dataset
}
if(AllOrSelection=="Selection"){
ComparativeDataset <- Dataset %>% filter (ADM0NAME %in% ListCountriesToCompare)
}
Comparative_SpaguettiPlot<-function (Country,Variable,AllOrSelection,ListCountriesToCompare,col){
Population<-Population %>% mutate(ADM0NAME=str_to_title(ADM0NAME)) %>% select(ADM0NAME,UNPOP2019)
Dataset<-GetEpiData() %>% mutate(ADM0NAME=str_to_title(ADM0NAME)) %>%
left_join(Population, by='ADM0NAME') %>%
mutate(DailyRateCases=NewCases/UNPOP2019*100000,
DailyRateDeaths=NewDeaths/UNPOP2019*100000,
CumulativeRateCases=TotalCases/UNPOP2019*1000000,
CumulativeRateDeaths=TotalDeaths/UNPOP2019*1000000)
Variable<-sym(Variable)
if(AllOrSelection=="All"){
ComparativeDataset<-Dataset
}
if(AllOrSelection=="Selection"){
ComparativeDataset <- Dataset %>% filter (ADM0NAME %in% ListCountriesToCompare)
}
if (grepl("Cases", Variable))
{if (Variable=="NewCases") {labelY<-"Daily number of cases"}
else if (Variable=="TotalCases") {labelY<-"Total number of cases"}
else if (Variable=="DailyRateCases") {labelY<-"Daily rate of cases (per 100.000)"}
else if (Variable=="CumulativeRateCases") {labelY<-"Cumulative rate of cases (per 100.000)"}}
else if (grepl("Deaths", Variable))
{if (Variable=="NewDeaths") {labelY<-"Daily number of deaths"}
else if (Variable=="TotalDeaths") {labelY<-"Total number of deaths"}
else if (Variable=="DailyRateDeaths") {labelY<-"Daily rate of deaths (per one million)"}
else if (Variable=="CumulativeRateDeaths") {labelY<-"Cumulative rate of deaths (per one million)"}}
CountryDataset<-Dataset %>% filter (ADM0NAME==Country)
plot<-ggplot()+
geom_line(data=ComparativeDataset,aes(x=DateReport,y=!!Variable,group=ADM0NAME),color="grey")+
geom_line(data=CountryDataset,
aes(x=DateReport,y=!!Variable),
color=col,size=0.8)+
labs(x="Date",y=labelY)+
theme_minimal()
return(list(plot=plot))
}
Comparative_SpaguettiPlot('Belgium','DailyRateCases','Selective',ListCountriesToCompare,col)$plot
getwd()
setwd('..')
getwd()
setwd('C:/Users/romanc/Documents/GitHub/Packages/SpaguettiPlot')
document()
document()
document()
document()
